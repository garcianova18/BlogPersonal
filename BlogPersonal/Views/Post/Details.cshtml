@model DTOs.DTO.DetailsPostVM
@{
    ViewData["Title"] = Model.Titulo;
    Layout = "~/Views/Shared/_Layout.cshtml";

}



<div class="container">




    <div class="row justify-content-evenly bg-light py-5 rounded-3 ">


        @* Seccion de detalles de los POST, Crear Comentarios y Mostrar Comentarios
        *@
        <div class="col-12 col-lg-8  mb-3 mb-md-0 ">


            @* ----------Seccion de Detalles del articulos------*@



            <div class=" border boder-1 g-0 shadow mb-5">

                @if (Model.Imagen is not null)
                {
                    <img src="/Imagenes/@Model.Imagen" class="card-img-top  img-fluid" alt="..." style="max-height:500px" />

                }
                else
                {

                    <div class="bg-primary w-100 d-flex justify-content-center align-items-center" style="height:250px">

                        <p class="text-black-50">Sube una imagen</p>

                    </div>


                }

                <div class=" px-3">

                    <div class="mt-2 ">

                        <p class=" bg-info d-inline-block p-1 text-white border rounded-3">@Model.IdCategoriaNavigationNombre</p>

                        @if (User.Identity.IsAuthenticated)
                        {
                            <div class="btn-group float-end">

                                <a asp-action="Edit" asp-controller="Post" asp-route-id="@Model.Id" class="btn btn-warning  ">

                                    <i class=" text-white fa-solid fa-pen-to-square fa-lg"></i>
                                </a>
                                <a asp-action="Delete" asp-controller="Post" asp-route-id="@Model.Id" class="btn btn-danger ">

                                    <i class="fa-solid fa-trash-can fa-lg"></i>
                                </a>
                            </div>
                        }

                    </div>


                    <p class="text-muted ">@Model.FechaPublicado.ToString("dd 'de' MMMM yyyy")</p>

                    <h1 class="text-capitalize ">@Model.Titulo</h1>

                    <p> @Html.Raw(Model.Descripcion)</p>


                    <p class="text-muted ">Autor <span class="text-primary">@Model.IdUserNavigationUserName</span></p>


                </div>

            </div>

            @*---------------seccion de paginacion--------------------------------*@



            <nav aria-label="Page navigation">

                <ul class="pagination d-flex justify-content-between">

                    @* si paginaanterior es igua a pagina actual bloqueamos el boton porque ya no existema mas post hacia a tras*@



                    @if (Model.PaginaAntetior == Model.PaginaActual)

                    {

                        <li class="page-item disabled">

                            <a class="page-link py-3 rounded-3" href="@Model.PaginaAntetior">Pagina Anterior</a>

                        </li>

                    }
                    else
                    {
                        <li class="page-item active ">

                            <a class="page-link py-3 rounded-3" href="@Model.PaginaAntetior">Pagina Anterior</a>

                        </li>
                    }


                    @if (Model.PaginaSiguiente == Model.PaginaActual)
                    {

                        <li class="page-item disabled ">

                            <a class="page-link py-3 rounded-3" href="@Model.PaginaSiguiente">Pagina Siguiente</a>

                        </li>


                    }
                    else
                    {
                        <li class=" page-item active">

                            <a class="page-link py-3 rounded-3" href="@Model.PaginaSiguiente">Pagina Siguiente</a>

                        </li>

                    }

                </ul>
            </nav>




            @* ----------Seccion de Comentarios del artuculo Crear y Mostrar------*@

            <div class="border boder-1 g-0 shadow  px-3">


                <p class="mt-3 ms-2"> @Model.ListComentarios.Count() Comentarios</p>


                @* ---- Crear un nuevo Comentario ----------------*@

                <form asp-controller="Post" asp-action="Details" method="post" class="mb-5 ">
                    <div asp-validation-summary="ModelOnly" class="text-danger"></div>

                    <textarea asp-for="Comentario.Descripcion" class="form-control py-3" placeholder="Agregar comentario"></textarea>
                    <span asp-validation-for="Comentario.Descripcion" class="text-danger"></span>

                    <input type="submit" class="btn btn-sm btn-success float-end  my-2" value="Enviar">


                </form>


                @* -----Mostrar todos los Comentarios de un POST------------*@

                @if (Model.ListComentarios is not null)
                {
                    @if (Model.ListComentarios.Count() > 0)
                    {
                        @foreach (var item in Model.ListComentarios.OrderByDescending(f => f.FechaPublicado))
                        {
                            <div class="border border-1 p-4 mb-3 rounded-2 d-flex flex-column ">

                                <div class="  d-flex align-items-center ">

                                   @* si el id del usuario es null significa que este comentario fue creado
                                   por un usuario que no esta registrado, entonces en el logo del autor mostamos la letra A*@
                                    @if (item.IdUser == null)
                                    {
                                        <p class="comentarios_autor">A</p>
                                    }
                                    else
                                    {   
                                       @* si fue creado por un usuario registrado registrado en el logo
                                       le ponemos la primera letra de su usuario*@
                                        <p class="comentarios_autor"> @item.IdUserNavigation.UserName.Substring(0,1)</p>
                                        
                                    }

                                    <p class="">@item.Descripcion</p>

                                </div>


                                <div class="">

                                    <small class="text-muted">@item.FechaPublicado.ToString("d")</small>

                                </div>



                            </div>
                        }
                    }
                }





            </div>



        </div>


        <div class="col-12 col-lg-4 col-xl-3 ">

            @* Seccion del listado de los articulos relacionados*@

            @await Html.PartialAsync("_ArticulosRelacionados", model:Model.ListPostVMs)

        </div>





    </div>


</div>

@section Scripts{


    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

 }

